import{ToastGenerator}from"../../class/ToastGenerator.min.js";import{CalloutGenerator}from"../../class/CalloutGenerator.min.js";import{DataTableManager}from"../../class/DataTableManager.min.js";import{DataFormatter}from"../../class/DataFormatter.min.js";import{ApiService}from"../../class/ApiService.min.js";function homeIndexPage(){new ToastGenerator,new CalloutGenerator;let s=new DataFormatter;new DataTableManager("phoneTable",{columns:[{data:0,name:"id",type:"numeric",createdCell:function(e,t,a,r,n){$(e).addClass("text-light fw-bold")}},{data:1,name:"last_name",type:"string",render:function(e,t,a){return e.toUpperCase()},createdCell:function(e,t,a,r,n){$(e).addClass("text-primary fw-bold")}},{data:2,name:"phone_number",type:"string",render:function(e,t,a){return s.format("phone",e)},createdCell:function(e,t,a,r,n){$(e).addClass("text-light fw-bold")}}],serverSide:!0,tableClass:"table-hover w-100"});var e=document.querySelector("#formHome"),t=document.querySelector("#inputLastName"),a=document.querySelector("#inputPhoneNumber");e.addEventListener("submit",function(e){e.preventDefault()}),t.addEventListener("input",n),a.addEventListener("input",n),e=document.querySelectorAll(".needs-validation"),Array.from(e).forEach(r=>{r.addEventListener("submit",e=>{var t=r.querySelector("#inputLastName"),a=r.querySelector("#inputPhoneNumber");t.value.trim()||a.value.trim()?(t.setCustomValidity(""),a.setCustomValidity("")):(t.setCustomValidity("At least one of Last Name or Phone Number must be filled out."),a.setCustomValidity("At least one of Last Name or Phone Number must be filled out.")),r.checkValidity()||(e.preventDefault(),e.stopPropagation()),r.classList.add("was-validated")},!1)});let r,i=null;function n(){let o=this.value.trim(),l=document.querySelector(".result");clearTimeout(r),r=setTimeout(async()=>{var t=new CalloutGenerator,e=new ApiService;if(0<o.length){i&&i.abort();var a=document.querySelector("#inputLastName"),r=document.querySelector("#inputPhoneNumber"),n={search:!0,last_name:a.value,phone_number:r.value};a.classList.contains("is-invalid")&&r.classList.contains("is-invalid")&&(a.classList.remove("is-invalid"),r.classList.remove("is-invalid"));document.querySelector("#cancelBtn")?.addEventListener("click",function(){l.classList.add("d-none"),l.innerHTML=""});a=new AbortController,r=a["signal"];i=a;try{let t=await e.post("process.php",n,{signal:r}),a=(l.classList.remove("d-none"),"");Array.isArray(t)&&0<t.length?t.forEach(e=>{a=(a+=`
                            <h3 class="text-primary">${e.last_name.charAt(0).toUpperCase()}${e.last_name.slice(1).toLowerCase()}</h3>
                            <br/>
                            <h4 class="text-light">${s.format("phone",e.phone_number)}</h4>`)+(1<t.length?'<hr class="text-light">':"")}):a+='<h3 class="text-primary fw-bold">Aucun résultat n\'a pu être trouvé avec ces informations.</h3>',l.innerHTML=a}catch(e){t.createCallout("Il y a eu un problème avec la requête : "+e)}finally{i=null}}else l.classList.add("d-none"),l.innerHTML=""},300)}}export{homeIndexPage};